# Tensorflow Installation Tutorial for Aura

This tutorial can be used to install TF 2.4 with Python < 3.9 and >= 3.5.

## Descrption

Installing Tensorflow through pip does not work because ```import tensorflow``` triggers SIGILL.
Aura's CPU does not have AVX capabilities, however prebuilt Tensorflow binary requires CPUs to do so.

## Steps

0. [Optional] instal pyenv and to not cross disk quotas install it in /var/tmp/$USER/..
1. ```python3 -m pip numpy wheel```
   ```python3 -m pip install keras_preprocessing --no-deps```
2. Download and install **bazel-3.1.0-linux-x86_64**from [bazel](github.com/bazelbuild/bazel/releases/tag/3.1.0), optionally put it into /var/tmp/$USER..
3. Clone Tensorflow repository and configure it.
   ```git clone https://github.com/tensorflow/tensorflow.git```
   ```cd tensorflow```
   ```git checkout r2.4``` - where 2.4 specifies release version
   ```python3 configure.py```
   Say NO to CUDA, ROCm, clang and android.
   When asked for compilation flags use `-march=native -mno-avx`
4. Build Tensorflow with Bazel, but change env variable $HOME, because Bazel uses ~/.cache and this causes disk quota issues.
   ```env HOME=/var/tmp/$USER bazel build --config=opt --config=noaws --config=nogcp --config=nohdfs --config=nonccl //tensorflow/tools/pip_package:build_pip_package```
5. Build wheel.
   ```./bazel-bin/tensorflow/tools/pip_package/build_pip_package DIR``` where DIR is any directory, for example /var/tmp/$USER/tensorflow_pkg
6. Install package through pip with given wheel but use the path to Python binary, because when using pyenv the `python3` command seems to default to system Python installation for wheels on Aura.
   ```PYTHON_BINARY_PATH -m pip install DIR/tensorflow-VERSION-TAGS.whl```
   where PYTHON_BINARY_PATH is path to python binary - for example for virtual env ENV and Python 3.8: /var/tmp/$USER/.pyenv/versions/ENV/PYVERSION/bin/Python3.8
   where DIR is the previously used directory, VERSION is used version and TAGS signify the platform

If anything is possibly unclear, refer to [tensorflow](tensorflow.org/install/source), since the tutorial is pretty much taken from this page and slightly adjusted to work on Aura.

